<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Êâ´ÊèèÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            color: #1d1d1f;
            text-align: center;
            margin-bottom: 12px;
        }

        .subtitle {
            text-align: center;
            color: #86868b;
            font-size: 17px;
            margin-bottom: 40px;
        }

        .input-group {
            position: relative;
            margin-bottom: 24px;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: #f5f5f7;
            border-radius: 12px;
            padding: 4px;
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            background: #e8e8ed;
            box-shadow: 0 0 0 4px rgba(0, 125, 250, 0.1);
        }

        #qrInput {
            flex: 1;
            border: none;
            background: transparent;
            padding: 14px 16px;
            font-size: 17px;
            color: #1d1d1f;
            outline: none;
        }

        #qrInput::placeholder {
            color: #86868b;
        }

        .camera-btn {
            background: #007aff;
            border: none;
            border-radius: 10px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 48px;
        }

        .camera-btn:hover {
            background: #0051d5;
            transform: scale(1.05);
        }

        .camera-btn:active {
            transform: scale(0.95);
        }

        .camera-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        #scanner {
            display: none;
            margin-top: 24px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        #scanner.active {
            display: block;
        }

        #reader {
            width: 100%;
            border-radius: 16px;
        }

        .close-btn {
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 16px;
            width: 100%;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: #d62f26;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
        }

        .close-btn:active {
            transform: translateY(0);
        }

        .status {
            text-align: center;
            margin-top: 16px;
            padding: 12px;
            border-radius: 10px;
            font-size: 15px;
            display: none;
        }

        .status.success {
            display: block;
            background: #d1f4e0;
            color: #248a3d;
        }

        .status.error {
            display: block;
            background: #ffd9d4;
            color: #c92a2a;
        }

        .status.info {
            display: block;
            background: #d6eaff;
            color: #0066cc;
        }

        @media (max-width: 640px) {
            .container {
                padding: 32px 24px;
            }

            h1 {
                font-size: 28px;
            }

            .subtitle {
                font-size: 15px;
            }
        }

        /* Êâ´ÊèèÊ°ÜÊ†∑Âºè */
        #reader__scan_region {
            border-radius: 12px !important;
        }

        #reader__dashboard_section_swaplink {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Êâ´ÊèèÂô®</h1>
        <p class="subtitle">ËæìÂÖ•ÊàñÊâ´Êèè‰∫åÁª¥Á†ÅÂÜÖÂÆπ</p>
        
        <div class="input-group">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="qrInput" 
                    placeholder="Âú®Ê≠§ËæìÂÖ•ÊàñÊâ´Êèè QR Code..."
                    autocomplete="off"
                >
                <button class="camera-btn" id="cameraBtn" title="Êâ´Êèè‰∫åÁª¥Á†Å">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 17.5c-2.481 0-4.5-2.019-4.5-4.5s2.019-4.5 4.5-4.5 4.5 2.019 4.5 4.5-2.019 4.5-4.5 4.5zm0-7.5c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"/>
                        <path d="M12 21c-4.963 0-9-4.037-9-9s4.037-9 9-9 9 4.037 9 9-4.037 9-9 9zm0-16.5c-4.136 0-7.5 3.364-7.5 7.5s3.364 7.5 7.5 7.5 7.5-3.364 7.5-7.5-3.364-7.5-7.5-7.5z"/>
                        <circle cx="12" cy="12" r="2"/>
                    </svg>
                </button>
            </div>
        </div>

        <div id="scanner">
            <div id="reader"></div>
            <button class="close-btn" id="closeBtn">ÂÖ≥Èó≠Êâ´Êèè</button>
        </div>

        <div class="status" id="status"></div>
    </div>

    <!-- ÂºïÂÖ• html5-qrcode Â∫ì -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <script>
        let html5QrCode;
        let isScanning = false;

        const cameraBtn = document.getElementById('cameraBtn');
        const closeBtn = document.getElementById('closeBtn');
        const scanner = document.getElementById('scanner');
        const qrInput = document.getElementById('qrInput');
        const status = document.getElementById('status');

        function showStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
            setTimeout(() => {
                status.className = 'status';
            }, 3000);
        }

        function onScanSuccess(decodedText, decodedResult) {
            // Êâ´ÊèèÊàêÂäüÔºåÂ°´ÂÖÖÂà∞ËæìÂÖ•Ê°Ü
            qrInput.value = decodedText;
            showStatus('‚úì Êâ´ÊèèÊàêÂäüÔºÅ', 'success');
            
            // ÂÅúÊ≠¢Êâ´Êèè
            stopScanning();
        }

        function onScanError(errorMessage) {
            // Êâ´ÊèèÈîôËØØÔºàÊåÅÁª≠Êâ´ÊèèÊó∂‰ºö‰∏çÊñ≠Ëß¶ÂèëÔºåÊâÄ‰ª•‰∏çÊòæÁ§∫ÈîôËØØÔºâ
            // console.log(errorMessage);
        }

        async function startScanning() {
            if (isScanning) return;

            try {
                scanner.classList.add('active');
                
                html5QrCode = new Html5Qrcode("reader");
                
                const config = { 
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    aspectRatio: 1.0
                };

                await html5QrCode.start(
                    { facingMode: "environment" }, // ‰ΩøÁî®ÂêéÁΩÆÊëÑÂÉèÂ§¥
                    config,
                    onScanSuccess,
                    onScanError
                );

                isScanning = true;
                showStatus('üì∑ Áõ∏Êú∫Â∑≤ÂêØÂä®ÔºåËØ∑ÂØπÂáÜ‰∫åÁª¥Á†Å', 'info');
            } catch (err) {
                showStatus('Êó†Ê≥ïÂêØÂä®Áõ∏Êú∫: ' + err, 'error');
                scanner.classList.remove('active');
            }
        }

        async function stopScanning() {
            if (!isScanning) return;

            try {
                await html5QrCode.stop();
                html5QrCode.clear();
                scanner.classList.remove('active');
                isScanning = false;
            } catch (err) {
                console.error('ÂÅúÊ≠¢Êâ´ÊèèÂá∫Èîô:', err);
            }
        }

        cameraBtn.addEventListener('click', () => {
            if (!isScanning) {
                startScanning();
            }
        });

        closeBtn.addEventListener('click', () => {
            stopScanning();
        });

        // È°µÈù¢Âç∏ËΩΩÊó∂ÂÅúÊ≠¢Êâ´Êèè
        window.addEventListener('beforeunload', () => {
            if (isScanning) {
                stopScanning();
            }
        });
    </script>
</body>
</html>
